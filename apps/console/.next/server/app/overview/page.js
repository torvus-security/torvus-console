(()=>{var e={};e.id=557,e.ids=[557],e.modules={2934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},4580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},5869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},852:e=>{"use strict";e.exports=require("async_hooks")},4300:e=>{"use strict";e.exports=require("buffer")},3685:e=>{"use strict";e.exports=require("http")},5687:e=>{"use strict";e.exports=require("https")},4577:e=>{"use strict";e.exports=require("punycode")},2781:e=>{"use strict";e.exports=require("stream")},7310:e=>{"use strict";e.exports=require("url")},9796:e=>{"use strict";e.exports=require("zlib")},5383:(e,s,r)=>{"use strict";r.r(s),r.d(s,{GlobalError:()=>n.a,__next_app__:()=>u,pages:()=>d,routeModule:()=>p,tree:()=>c});var a=r(6661),t=r(4749),i=r(6933),n=r.n(i),l=r(1769),o={};for(let e in l)0>["default","tree","pages","GlobalError","__next_app__","routeModule"].indexOf(e)&&(o[e]=()=>l[e]);r.d(s,o);let c=["",{children:["overview",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(r.bind(r,5762)),"/Users/haydenfarquhar/Projects/torvus-console/apps/console/app/overview/page.tsx"]}]},{}]},{layout:[()=>Promise.resolve().then(r.bind(r,6086)),"/Users/haydenfarquhar/Projects/torvus-console/apps/console/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(r.t.bind(r,8271,23)),"next/dist/client/components/not-found-error"]}],d=["/Users/haydenfarquhar/Projects/torvus-console/apps/console/app/overview/page.tsx"],u={require:r,loadChunk:()=>Promise.resolve()},p=new a.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/overview/page",pathname:"/overview",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},966:(e,s,r)=>{Promise.resolve().then(r.t.bind(r,7868,23))},4113:(e,s,r)=>{Promise.resolve().then(r.t.bind(r,1387,23)),Promise.resolve().then(r.t.bind(r,8739,23)),Promise.resolve().then(r.t.bind(r,3285,23)),Promise.resolve().then(r.t.bind(r,6753,23)),Promise.resolve().then(r.t.bind(r,1722,23)),Promise.resolve().then(r.t.bind(r,320,23))},6723:()=>{},6086:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>h,metadata:()=>u,runtime:()=>p});var a=r(36),t=r(2746),i=r(7416),n=r(1928),l=r(3613),o=r(4463);r(1425),r(5178);var c=r(3199),d=r(9584);let u={title:"Torvus Console",description:"Privileged Torvus staff portal with RBAC, dual-control, and audit evidence.",icons:[{rel:"icon",url:"/favicon.ico"}]},p="nodejs";async function h({children:e}){let s=(0,i.headers)(),r=s.get("x-pathname")??"/",u=s.get("x-csp-nonce")??"",p=s.get("x-correlation-id")??crypto.randomUUID(),h=r.startsWith("/enroll-passkey"),m=await (0,c.Ot)();if(!m)return a.jsx("html",{lang:"en","data-theme":"torvus-staff",children:a.jsx("body",{"data-correlation":p,className:"body-minimal",children:(0,a.jsxs)("main",{className:"unauthorised",children:[a.jsx("h1",{children:"Access denied"}),a.jsx("p",{children:"Torvus Console is restricted to enrolled staff. Contact Security Operations."})]})})});if(m.passkeyEnrolled||h||(0,n.redirect)("/enroll-passkey"),(0,d.C4)().capture("staff_console_viewed",{path:r,env:"production",user:m.analyticsId,correlation_id:p}),h)return a.jsx("html",{lang:"en","data-theme":"torvus-staff",children:a.jsx("body",{"data-correlation":p,className:"body-minimal",children:a.jsx(l.Suspense,{fallback:a.jsx("div",{className:"loading","data-testid":"loading"}),children:e})})});let f=(0,d.mL)(m.permissions);return a.jsx("html",{lang:"en","data-theme":"torvus-staff",children:(0,a.jsxs)("body",{"data-correlation":p,className:"layout-shell",children:[(0,a.jsxs)("aside",{className:"sidebar","aria-label":"Primary",children:[(0,a.jsxs)("div",{className:"sidebar__brand",children:[a.jsx("span",{className:"brand-mark","aria-hidden":!0,children:"⚡"}),a.jsx("span",{className:"brand-text",children:"Torvus Console"})]}),a.jsx("nav",{children:a.jsx("ul",{children:f.map(e=>a.jsx("li",{children:a.jsx(t.default,{href:e.href,className:(0,o.Z)("nav-link",{active:r===e.href||"/"!==e.href&&r.startsWith(e.href)}),children:e.label})},e.href))})}),(0,a.jsxs)("footer",{children:[a.jsx("span",{className:"staff-name",children:m.displayName}),a.jsx("span",{className:"staff-email",children:m.email})]})]}),(0,a.jsxs)("div",{className:"content",children:[(0,a.jsxs)("header",{className:"topbar",children:[a.jsx("div",{className:"breadcrumbs",children:"/"===r?"Overview":r.replace("/","").replace("-"," ")}),a.jsx("div",{className:"topbar__meta","data-nonce":u,children:a.jsx("span",{className:"tag",children:m.roles.join(", ")||"staff"})})]}),a.jsx("main",{className:"main","data-testid":"main-content",children:a.jsx(l.Suspense,{fallback:a.jsx("div",{className:"loading","data-testid":"loading"}),children:e})})]})]})})}},5762:(e,s,r)=>{"use strict";r.r(s),r.d(s,{default:()=>u});var a=r(36),t=r(7416),i=r(4463),n=r(3199),l=r(9584);let o={activeAlerts:0,openInvestigations:0,releaseTrainStatus:"idle",lastIncidentAt:null};async function c(e){let s=process.env.TORVUS_PLATFORM_STATS_URL??`${process.env.TORVUS_PLATFORM_URL??""}/api/stats`;if(!s)return o;try{let r=await fetch(s,{cache:"no-store",headers:{Accept:"application/json","X-Correlation-Id":e}});if(!r.ok)return console.warn("Failed to load overview stats",r.statusText),o;let a=await r.json();return{activeAlerts:a.activeAlerts??o.activeAlerts,openInvestigations:a.openInvestigations??o.openInvestigations,releaseTrainStatus:a.releaseTrainStatus??o.releaseTrainStatus,lastIncidentAt:a.lastIncidentAt??o.lastIncidentAt}}catch(e){return console.warn("Overview stats fetch failed",e),o}}function d({correlationId:e}){let s=process.env.NEXT_PUBLIC_STATUSPAGE_URL??(process.env.NEXT_PUBLIC_STATUSPAGE_PAGE_ID?`https://${process.env.NEXT_PUBLIC_STATUSPAGE_PAGE_ID}.statuspage.io`:null);return s?(0,a.jsxs)("section",{className:"panel","aria-labelledby":"statuspage-heading",children:[a.jsx("div",{className:"panel__header",children:a.jsx("h2",{id:"statuspage-heading",children:"Statuspage"})}),a.jsx("iframe",{src:`${s}/embed/status`,title:"Torvus Statuspage",sandbox:"allow-same-origin allow-scripts allow-popups",loading:"lazy",referrerPolicy:"no-referrer",className:"iframe-status","data-correlation":e})]}):(0,a.jsxs)("section",{className:"panel","aria-labelledby":"statuspage-heading",children:[(0,a.jsxs)("div",{className:"panel__header",children:[a.jsx("h2",{id:"statuspage-heading",children:"Statuspage"}),a.jsx("span",{className:"tag subtle",children:"Not configured"})]}),a.jsx("p",{className:"muted",children:"Set NEXT_PUBLIC_STATUSPAGE_PAGE_ID to embed the production status page."})]})}async function u(){var e;let s=await (0,n.vT)({permission:"metrics.view"}),r=(0,t.headers)().get("x-correlation-id")??crypto.randomUUID(),o=await c(r);return(0,l.C4)().capture("staff_console_viewed",{path:"/overview",user:s.analyticsId,correlation_id:r}),(0,a.jsxs)("div",{className:"page",children:[(0,a.jsxs)("div",{className:"cards",children:[(0,a.jsxs)("article",{className:"card",children:[(0,a.jsxs)("header",{children:[a.jsx("h2",{children:"Active alerts"}),a.jsx("span",{className:"metric",children:o.activeAlerts})]}),a.jsx("p",{className:"muted",children:"Alerts open across Torvus platform services."})]}),(0,a.jsxs)("article",{className:"card",children:[(0,a.jsxs)("header",{children:[a.jsx("h2",{children:"Open investigations"}),a.jsx("span",{className:"metric",children:o.openInvestigations})]}),a.jsx("p",{className:"muted",children:"Endpoint triage items assigned to Console operators."})]}),(0,a.jsxs)("article",{className:"card",children:[(0,a.jsxs)("header",{children:[a.jsx("h2",{children:"Release train"}),a.jsx("span",{className:(0,i.Z)("metric",o.releaseTrainStatus),children:o.releaseTrainStatus})]}),a.jsx("p",{className:"muted",children:"Release execution remains feature-flagged pending dual-control validation."})]}),(0,a.jsxs)("article",{className:"card",children:[(0,a.jsxs)("header",{children:[a.jsx("h2",{children:"Last incident"}),a.jsx("span",{className:"metric",children:(e=o.lastIncidentAt)?new Date(e).toLocaleString("en-US",{hour12:!1,timeZone:"UTC"}):"—"})]}),a.jsx("p",{className:"muted",children:"UTC timestamp, pulled from audit trail for evidence parity."})]})]}),(0,a.jsxs)("div",{className:"grid-two",children:[a.jsx(d,{correlationId:r}),(0,a.jsxs)("section",{className:"panel","aria-labelledby":"system-heading",children:[(0,a.jsxs)("div",{className:"panel__header",children:[a.jsx("h2",{id:"system-heading",children:"System signals"}),a.jsx("span",{className:"tag subtle",children:"Read only"})]}),(0,a.jsxs)("dl",{className:"kv",children:[(0,a.jsxs)("div",{children:[a.jsx("dt",{children:"Environment"}),a.jsx("dd",{children:"production"})]}),(0,a.jsxs)("div",{children:[a.jsx("dt",{children:"Feature flag"}),a.jsx("dd",{children:"1"===process.env.TORVUS_FEATURE_ENABLE_RELEASE_EXECUTION?"enabled":"disabled"})]}),(0,a.jsxs)("div",{children:[a.jsx("dt",{children:"Supabase project"}),a.jsx("dd",{children:process.env.SUPABASE_URL??"unset"})]}),(0,a.jsxs)("div",{children:[a.jsx("dt",{children:"Correlation ID"}),a.jsx("dd",{children:r})]})]})]})]})]})}},9584:(e,s,r)=>{"use strict";r.d(s,{Se:()=>o,mL:()=>c,C4:()=>l});let a=require("node:crypto"),t=[{href:"/overview",label:"Overview",permission:"metrics.view"},{href:"/audit-events",label:"Audit Events",permission:"audit.read"},{href:"/releases",label:"Releases",permission:"releases.simulate"}];class i{capture(e,s={}){let r={event:e,properties:{$lib:"torvus-console",env:"production",...s},uuid:(0,a.randomUUID)()};this.queue.push({event:e,payload:r.properties}),this.host&&this.key&&fetch(`${this.host}/capture/`,{method:"POST",headers:{Authorization:`Bearer ${this.key}`,"Content-Type":"application/json"},body:JSON.stringify(r)}).catch(e=>{console.warn("Analytics capture failed",e)})}getQueue(){return[...this.queue]}constructor(){this.queue=[],this.host=process.env.NEXT_PUBLIC_POSTHOG_HOST,this.key=process.env.NEXT_PUBLIC_POSTHOG_KEY}}let n=null;function l(){return n||(n=new i),n}function o(e){let s=(0,a.createHash)("sha256");return s.update(e.trim().toLowerCase()),s.digest("hex")}function c(e){return t.filter(s=>!s.permission||e.includes(s.permission)).map(({href:e,label:s})=>({href:e,label:s}))}},3199:(e,s,r)=>{"use strict";r.d(s,{Ot:()=>o,vT:()=>c});var a=r(3613),t=r(1682),i=r(9584);class n extends Error{constructor(e,s=403){super(e),this.status=s,this.name="StaffAccessError"}}let l=(0,a.cache)(async()=>{let e=(0,t.jq)(),{data:s,error:r}=await e.auth.getUser();return r?(console.error("Failed to resolve session user",r),null):s.user?{id:s.user.id,email:s.user.email??"unknown@torvussecurity.com"}:null}),o=(0,a.cache)(async()=>{let e=await l();if(!e)return null;let s=(0,t.i_)(),{data:r,error:a}=await s.from("staff_users").select("user_id, email, display_name, passkey_enrolled").eq("user_id",e.id).maybeSingle();if(a)throw console.error("Error loading staff user",a),new n("Unable to load staff profile",503);if(!r)return null;let{data:o,error:c}=await s.from("staff_role_members").select("role_id").eq("user_id",e.id);if(c)throw console.error("Error loading staff roles",c),new n("Unable to load staff roles",503);let d=o?.map(e=>e.role_id)??[],u=[],p=new Set;if(d.length){let{data:e,error:r}=await s.from("staff_roles").select("id, name").in("id",d);if(r)throw console.error("Error loading staff role names",r),new n("Unable to resolve role names",503);u=e?.map(e=>e.name)??[];let{data:a,error:t}=await s.from("staff_role_permissions").select("permission_key, role_id").in("role_id",d);if(t)throw console.error("Error loading staff permissions",t),new n("Unable to load staff permissions",503);a?.forEach(e=>{p.add(e.permission_key)})}return{id:r.user_id,email:r.email,displayName:r.display_name,passkeyEnrolled:r.passkey_enrolled,roles:u,permissions:Array.from(p),analyticsId:(0,i.Se)(r.email)}});async function c(e){let s=await o();if(!s)throw new n("Staff membership required",403);if(e?.permission&&!s.permissions.includes(e.permission))throw new n(`Missing required permission: ${e.permission}`,403);return s}},1682:(e,s,r)=>{"use strict";r.d(s,{i_:()=>d,jq:()=>o});var a=r(5665),t=r(6663),i=r(7416);let n=["SUPABASE_URL","SUPABASE_ANON_KEY","SUPABASE_SERVICE_ROLE"];function l(){for(let e of n)if(!process.env[e])throw Error(`Missing required environment variable ${e}`)}function o(){return l(),(0,t.createServerComponentClient)({cookies:i.cookies},{supabaseUrl:process.env.SUPABASE_URL,supabaseKey:process.env.SUPABASE_ANON_KEY})}let c=null;function d(){return l(),c||(c=(0,a.eI)(process.env.SUPABASE_URL,process.env.SUPABASE_SERVICE_ROLE,{auth:{autoRefreshToken:!1,persistSession:!1}})),c}},5178:()=>{},1425:()=>{}};var s=require("../../webpack-runtime.js");s.C(e);var r=e=>s(s.s=e),a=s.X(0,[925,13,870],()=>r(5383));module.exports=a})();